{% extends "base.html" %}
{% block content %}
<section class="card">
  <h1>Utilisateurs</h1>
  {% if error %}<p class="error">{{ error }}</p>{% endif %}
  {% if success %}<p class="success">{{ success }}</p>{% endif %}
  <form method="post" class="form">
    <label>Identifiant
      <input type="text" name="username" required />
    </label>
    <label>Mot de passe
      <input type="password" name="password" required />
    </label>
    <label>Rôle
      <select name="role" required>
        <option value="admin">Admin</option>
        <option value="chief">Chef de poste</option>
        <option value="stock">Stock</option>
      </select>
    </label>
    <button type="submit" class="btn">Créer</button>
  </form>
  <div class="list">
    {% for item in users %}
    <div class="list-item">
      <div>
        <strong>{{ item.username }}</strong> — {{ item.role }}
        {% if item.id == user.id %}
        <span class="badge">Vous</span>
        {% endif %}
        {% if item.must_change_password %}
        <span class="badge">Mot de passe à changer</span>
        {% endif %}
      </div>
      <div class="list-item-actions">
        <form method="post" action="/users/{{ item.id }}/password" class="inline-form">
          <input
            type="password"
            name="new_password"
            placeholder="Nouveau mot de passe"
            required
          />
          <button type="submit" class="btn small">Changer</button>
        </form>
        <form method="post" action="/users/{{ item.id }}/delete" class="inline-form">
          <button
            type="submit"
            class="btn danger small"
            {% if item.id == user.id %}disabled{% endif %}
          >
            Supprimer
          </button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
