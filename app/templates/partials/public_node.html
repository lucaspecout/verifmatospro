{% if branch.node.node_type == 'container' %}
  <details
    class="checklist-section {{ branch.status or '' }}"
    data-node-id="{{ branch.node.id }}"
    data-parent-id="{{ branch.node.parent_id if branch.node.parent_id is not none else 'root' }}"
    data-node-type="{{ branch.node.node_type }}"
    data-status="{{ branch.status or 'pending' }}"
    open
  >
    <summary class="checklist-section-header">
      <div>
        <h2>{{ branch.node.name }}</h2>
        <p class="section-subtitle">Contrôlez le contenu avant le départ.</p>
      </div>
      {% if branch.status %}
        <span class="section-status {{ branch.status }}" data-role="status">{{ branch.status }}</span>
      {% endif %}
    </summary>
    {% if branch.children %}
      <div class="checklist-section-body">
        {% for child in branch.children %}
          {% set branch = child %}
          {% include "partials/public_node.html" %}
        {% endfor %}
      </div>
    {% endif %}
  </details>
{% else %}
  <div
    class="checklist-item {{ branch.status or '' }}"
    data-node-id="{{ branch.node.id }}"
    data-parent-id="{{ branch.node.parent_id if branch.node.parent_id is not none else 'root' }}"
    data-node-type="{{ branch.node.node_type }}"
    data-status="{{ branch.status or 'pending' }}"
    data-comment="{{ branch.node.comment or '' }}"
    data-node-name="{{ branch.node.name }}"
  >
    <div class="checklist-item-row">
      <div class="checklist-item-info">
        <div class="checklist-item-name">
          <strong>{{ branch.node.name }}</strong>
          {% if branch.status %}
            <span class="status {{ branch.status }}" data-role="status">{{ branch.status }}</span>
          {% endif %}
        </div>
        <span class="qty">Attendu: {{ branch.node.expected_qty or '-' }}</span>
      </div>
      <form method="post" action="/public/{{ event.id }}/{{ token }}/item/{{ branch.node.id }}" class="checklist-form compact">
        <input type="hidden" name="comment" value="{{ branch.node.comment or '' }}" />
        <div class="checklist-actions">
          <button class="toggle-btn ok" type="button" data-status="ok">OK</button>
          <button class="toggle-btn problem" type="button" data-status="problem">Non</button>
        </div>
      </form>
    </div>
  </div>
{% endif %}
